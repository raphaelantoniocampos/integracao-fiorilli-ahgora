{% for job in jobs %}
<tr class="hover:bg-slate-50 transition-colors group">
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-xs font-mono text-slate-400 group-hover:text-slate-600 transition-colors">{{ (job.id |
            string).split('-')[0] }}...</div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap">
        {% set status_class = "indigo-100 text-indigo-700" %}
        {% if job.status == 'success' %}{% set status_class = "emerald-100 text-emerald-700" %}
        {% elif job.status == 'failed' %}{% set status_class = "red-100 text-red-700" %}
        {% elif job.status == 'cancelled' %}{% set status_class = "slate-200 text-slate-600" %}
        {% elif job.status == 'running' %}{% set status_class = "blue-600 text-white animate-pulse" %}
        {% endif %}

        <span
            class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full {{ status_class }} uppercase tracking-wider">
            {% if job.status == 'running' %}
            <svg class="animate-spin -ml-1 mr-2 h-3 w-3 text-white" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            {% endif %}
            {{ job.status }}
        </span>
    </td>
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="flex flex-col">
            <span class="text-sm font-medium text-slate-700">{{ job.started_at.strftime('%H:%M:%S') if job.started_at
                else '--:--:--' }}</span>
            <span class="text-[10px] text-slate-400">
                {% if job.finished_at and job.started_at %}
                Duração: {{ ((job.finished_at - job.started_at).total_seconds() | int) }}s
                {% elif job.started_at %}
                Em andamento...
                {% else %}
                -
                {% endif %}
            </span>
        </div>
    </td>
    <td class="px-6 py-4">
        <div class="text-sm text-slate-600 truncate max-w-sm" title="{{ job.error_message or '' }}">
            {{ job.error_message or ('Operação em andamento...' if job.status == 'running' else '-') }}
        </div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
        {% if job.status == 'running' %}
        <button hx-post="/api/sync/jobs/{{ job.id }}/kill" hx-swap="none"
            class="text-red-400 hover:text-red-700 p-2 hover:bg-red-50 rounded-full transition-all"
            title="Cancelar Job">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
        </button>
        {% endif %}

        {% if job.status == 'success' %}
        <button hx-get="/partials/tasks?job_id={{ job.id }}" hx-target="#tasks-section"
            class="text-indigo-400 hover:text-indigo-700 p-2 hover:bg-indigo-50 rounded-full transition-all"
            title="Ver Detalhes">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                </path>
            </svg>
        </button>
        {% endif %}

        <button hx-get="/partials/logs?job_id={{ job.id }}" hx-target="#modal-content"
            class="text-slate-400 hover:text-slate-700 p-2 hover:bg-slate-50 rounded-full transition-all"
            title="Ver Logs">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10">
                </path>
            </svg>
        </button>
    </td>
</tr>
{% else %}
<tr>
    <td colspan="5" class="px-6 py-12 text-center text-slate-400 italic">
        <div class="flex flex-col items-center">
            <svg class="w-12 h-12 text-slate-200 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0a2 2 0 01-2 2H6a2 2 0 01-2-2m16 0V9a2 2 0 00-2-2H6a2 2 0 00-2 2v4m16 4v1a2 2 0 01-2 2H6a2 2 0 01-2-2v-1m16-4l-8 8-4-4">
                </path>
            </svg>
            Nenhuma execução encontrada no histórico.
        </div>
    </td>
</tr>
{% endfor %}